<div class="container mt-4">
  <div class="row">
    <!-- Ticker Field -->
    <div class="col-md-3">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Ticker</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="search" />
      </mat-form-field>
    </div>

    <!-- Price Field -->
    <div class="col-md-3">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Price</mat-label>
        <mat-select (selectionChange)="applyPriceFilter($event.value)" disableOptionCentering>
          <mat-option *ngFor="let priceFilter of priceFilters" [value]="priceFilter.value">
            {{ priceFilter.viewValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- 30mRv Field -->
    <div class="col-md-3">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>30mRv</mat-label>
        <mat-select (selectionChange)="apply30mRvFilter($event.value)" disableOptionCentering>
          <mat-option *ngFor="let rvFilter of rvFilters" [value]="rvFilter.value">
            {{ rvFilter.viewValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- 30mRsrw Field -->
    <div class="col-md-3">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>30mRsrw</mat-label>
        <mat-select (selectionChange)="apply30mRsFilter($event.value)" disableOptionCentering>
          <mat-option *ngFor="let rsFilter of rsFilters" [value]="rsFilter.value">
            {{ rsFilter.viewValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>
</div>

<div class="container mt-4">
  <mat-card class="mt-4">
    <div class="table-responsive">
      <table class="wide-table" mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">
        <!-- Ticker Column -->
        <ng-container matColumnDef="ticker" sticky>
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Ticker</th>
          <td mat-cell *matCellDef="let statistic" class="indigo-color">{{ statistic.ticker }}</td>
        </ng-container>

        <!-- Price Column -->
        <ng-container matColumnDef="price">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Price</th>
          <td mat-cell *matCellDef="let statistic">{{ statistic.price }}</td>
        </ng-container>

        <!-- ATR Column -->
        <ng-container matColumnDef="atr">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="grey-header">
            ATR
          </th>
          <td mat-cell *matCellDef="let statistic">{{ statistic.atr }}</td>
        </ng-container>

        <!-- FifteenMin Rvol Column -->
        <ng-container matColumnDef="fifteenMinRvol">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>15mRv</th>
          <td mat-cell *matCellDef="let statistic" [ngClass]="{
              'positive-value': statistic.fifteenMin.rvol > 100,
              'negative-value': statistic.fifteenMin.rvol < 100
            }">
            {{ statistic.fifteenMin.rvol }}
          </td>
        </ng-container>

        <!-- FifteenMin RsRw Column -->
        <ng-container matColumnDef="fifteenMinRsRw">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>15mRs</th>
          <td mat-cell *matCellDef="let statistic" [ngClass]="{
              'positive-value': statistic.fifteenMin.rsrw > 0,
              'negative-value': statistic.fifteenMin.rsrw < 0
            }">
            {{ statistic.fifteenMin.rsrw }}
          </td>
        </ng-container>

        <!-- ThirtyMin Rvol Column -->
        <ng-container matColumnDef="thirtyMinRvol">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>30mRv</th>
          <td mat-cell *matCellDef="let statistic" [ngClass]="{
              'positive-value': statistic.thirtyMin.rvol > 100,
              'negative-value': statistic.thirtyMin.rvol < 100
            }">
            {{ statistic.thirtyMin.rvol }}
          </td>
        </ng-container>

        <!-- ThirtyMin RsRw Column -->
        <ng-container matColumnDef="thirtyMinRsRw">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>30mRs</th>
          <td mat-cell *matCellDef="let statistic" [ngClass]="{
              'positive-value': statistic.thirtyMin.rsrw > 0,
              'negative-value': statistic.thirtyMin.rsrw < 0
            }">
            {{ statistic.thirtyMin.rsrw }}
          </td>
        </ng-container>

        <!-- OneHour Rvol Column -->
        <ng-container matColumnDef="oneHourRvol">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>1hRv</th>
          <td mat-cell *matCellDef="let statistic" [ngClass]="{
              'positive-value': statistic.oneHour.rvol > 100,
              'negative-value': statistic.oneHour.rvol < 100
            }">
            {{ statistic.oneHour.rvol }}
          </td>
        </ng-container>

        <!-- OneHour RsRw Column -->
        <ng-container matColumnDef="oneHourRsRw">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>1hRs</th>
          <td mat-cell *matCellDef="let statistic" [ngClass]="{
              'positive-value': statistic.oneHour.rsrw > 0,
              'negative-value': statistic.oneHour.rsrw < 0
            }">
            {{ statistic.oneHour.rsrw }}
          </td>
        </ng-container>

        <!-- TwoHour Rvol Column -->
        <ng-container matColumnDef="twoHourRvol">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>2hRv</th>
          <td mat-cell *matCellDef="let statistic" [ngClass]="{
              'positive-value': statistic.twoHour.rvol > 100,
              'negative-value': statistic.twoHour.rvol < 100
            }">
            {{ statistic.twoHour.rvol }}
          </td>
        </ng-container>

        <!-- TwoHour RsRw Column -->
        <ng-container matColumnDef="twoHourRsRw">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>2hRs</th>
          <td mat-cell *matCellDef="let statistic" [ngClass]="{
              'positive-value': statistic.twoHour?.rsrw > 0,
              'negative-value': statistic.twoHour.rsrw < 0
            }">
            {{ statistic.twoHour.rsrw }}
          </td>
        </ng-container>

        <!-- FourHour Rvol Column (nullable) -->
        <ng-container matColumnDef="fourHourRvol">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>4hRv</th>
          <td mat-cell *matCellDef="let statistic" [ngClass]="{
              'positive-value': statistic.fourHour.rvol > 100,
              'negative-value': statistic.fourHour.rvol < 100
            }">
            {{ statistic.fourHour?.rvol }}
          </td>
        </ng-container>

        <!-- FourHour RsRw Column (nullable) -->
        <ng-container matColumnDef="fourHourRsRw">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>4hRs</th>
          <td mat-cell *matCellDef="let statistic" [ngClass]="{
              'positive-value': statistic.fourHour?.rsrw > 0,
              'negative-value': statistic.fourHour.rsrw < 0
            }">
            {{ statistic.fourHour?.rsrw }}
          </td>
        </ng-container>

        <!-- Action -->
        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef>Action</th>
          <td mat-cell *matCellDef="let statistic">
            <button mat-mini-fab class="green-button" (click)= "openDialog(statistic.ticker)" aria-label="Add to watchlist">
              <mat-icon>add</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
    <mat-card-footer>
      <mat-paginator [pageSizeOptions]="[5, 10, 25, 50, 100, 200, 500]"
        aria-label="Select page of users"></mat-paginator>
      <span class="ms-2">Last updated:{{ firstTimestamp }}</span>
    </mat-card-footer>
  </mat-card>
</div>